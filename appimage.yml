app: python-app-image
binpatch: true

build:
  packages:
    - make
    - libexpat-devel
    - keyutils-devel
    - krb5-devel
    - zlib-devel
    - ncurses-devel
    - gdbm-devel
    - xz-devel
    - readline-devel
    - libcom_err-devel
    - libuuid-devel
    - libcurl-devel
    - kernel-devel
    - tk-devel
    - libzip-devel
    - python3-devel
    - sqlite3-devel
    - libopenssl-1_1-devel
    - linuxdeploy
  git:
    - https://github.com/python/cpython/tree/3.9

script:
  - cd $BUILD_SOURCE_DIR/python
  # - CPPFLAGS="-I/usr/local/sqlite3/include"
  # - LDFLAGS="-Wl,-rpath=/usr/local/sqlite3/lib"
  - ./configure --enable-optimizations --enable-loadable-sqlite-extensions --with-pydebug
  - make
  - make INSTALL_ROOT=$BUILD_APPDIR install
  - unset LD_LIBRARY_PATH
  - linuxdeploy $BUILD_APPDIR
